<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <div id="pinTooltip"></div>
    <script>
        const locations=[
            {id: 0, name: "Location 1", x:50, y:50},
            {id: 1, name: "Location 2", x:150, y:100},
            {id: 2, name: "Location 3", x:250, y:150}
        ];

        function loadPinsFromLocations()
        {
            const gridMap = document.getElementById('gridMap');
            // for (location of locations) {
            for (let i = 0; i < locations.length; i++) {
                let location = locations[i];
                let pin = createPin(location, gridMap);
                gridMap.appendChild(pin);
            }
        }

        function createPin(location, gridMap) {
            let pin = document.createElement('div');
            pin.className = 'pin';
            pin.style.left = location.x + 'px';
            pin.style.top = location.y + 'px';

            // Tooltip logic
            pin.onmouseenter = function(e) {
                const tooltip = document.getElementById('pinTooltip');
                tooltip.innerHTML = `
                    <strong>${location.name}</strong><br>
                    <b>ID:</b> ${location.id}<br>
                    <b>X:</b> ${Math.round(location.x)}<br>
                    <b>Y:</b> ${Math.round(location.y)}
                `;
                tooltip.style.display = 'block';
                // Position tooltip near the pin
                const rect = pin.getBoundingClientRect();
                tooltip.style.left = (rect.left + window.scrollX + 20) + 'px';
                tooltip.style.top = (rect.top + window.scrollY - 10) + 'px';
            };
            pin.onmousemove = function(e) {
                const tooltip = document.getElementById('pinTooltip');
                tooltip.style.left = (e.clientX + 20) + 'px';
                tooltip.style.top = (e.clientY - 10) + 'px';
            };
            pin.onmouseleave = function() {
                document.getElementById('pinTooltip').style.display = 'none';
            };

            pin.onmousedown = function(e) {
                let shiftX = e.clientX - pin.getBoundingClientRect().left;
                let shiftY = e.clientY - pin.getBoundingClientRect().top;

                function moveAt(pageX, pageY) {
                    let rect = gridMap.getBoundingClientRect();
                    let x = pageX - rect.left - shiftX;
                    let y = pageY - rect.top - shiftY;
                    x = Math.max(0, Math.min(x, gridMap.offsetWidth - pin.offsetWidth));
                    y = Math.max(0, Math.min(y, gridMap.offsetHeight - pin.offsetHeight));
                    pin.style.left = x + 'px';
                    pin.style.top = y + 'px';
                    // Update location object
                    location.x = x;
                    location.y = y;
                }
                function onMouseMove(e) {
                    moveAt(e.pageX, e.pageY);
                }
                document.addEventListener('mousemove', onMouseMove);
                document.onmouseup = function() {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.onmouseup = null;
                };
            };

            pin.ondragstart = function() {
                return false;
            };

            return pin;
        }
    </script>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f4f4f4;
    text-align: center;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

#gridMap {
    width: 90%;
    height: 600px;
    border: 1px solid #ccc;
    background: url('mapbg.jpg') no-repeat center center;
    position: relative;
    margin: 40px auto; /* Centraliza horizontalmente */
    display: block;    /* Garante que a margem funcione */
}
.pin {
    width: 16px;
    height: 16px;
    /* background: rgba(255, 0, 0, 0.5); */
    background: url('pin.png') no-repeat center center;
    /* border-radius: 0 50% 50% 50%; */
    position: absolute;
    cursor: grab;
    /* border: 1px solid #fff; */
    /* box-shadow: 0 2px 6px rgba(0,0,0,0.8); */
}
.pin:active {
    cursor: grabbing;
}
.pin:hover {
    background: url('pin.png') no-repeat center center;
}

#pinTooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 5px;
    border-radius: 5px;
    display: none;
    z-index: 1000;
    text-align: left;
}

</style>

</head>
<button onclick="loadPinsFromLocations()">adicionar os pins</button>
<body>
    <div id="gridMap">
        <!-- Pins will be added here -->
    </div>
</body>
</html>